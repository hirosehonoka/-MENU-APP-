# 献立作成アプリデータベース設計書

作成日：2025/10/1
版：2版
作成者：廣瀬萌花

### データベース構成

menuapp_db
|テーブル名|和名|備考|
|:--|:--|:--|
|user|ユーザテーブル|ユーザの情報を格納|
|menu|献立テーブル|献立の情報を格納|
|recipes|レシピテーブル|レシピの情報を格納|
|recipeItems|食材テーブル|レシピに使用される食材の情報を格納|
|recipeNutritions|レシピ栄養テーブル|レシピに含まれる栄養素量の情報を格納|
|nutritionalTargets|目標栄養テーブル|年齢・性別・運動レベルごとの目標栄養素量の情報を格納|
|itemWeights|食材重量テーブル|特定の食材の１個あたりの重量を格納|
|itemEquals|食材紐付テーブル|食材テーブルでは違う食材として格納しているが実際には同じ食材を使用する食材(卵とゆで卵)を格納|
|recipeUrl|レシピURLテーブル|レシピのURLを格納。アプリでの表示に使用する。|

### user

ユーザに対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|userId|ユーザID|integer|〇|NO|AUTO_INCREMENT||
|userName|ユーザ名|character varying(20)||NO|UNIQUE||
|password|パスワード|character varying(200)||NO||保存時にはハッシュ化する|
|userInfo|ユーザ情報|jsonb||NO||ユーザの年齢・性別・運動レベルをまとめて格納|

テーブル例
|userId|userName|passwprd|userInfo|
|:--|:--|:--|:--|
|1|hirohono|scrypt:ハッシュ化後の値|{"年齢": "18~29(歳)","性別": "女性","運動レベル": "ふつう"}|

### menu

献立に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|menuId|献立ID|integer|〇|NO|AUTO_INCREMENT||
|menu1|献立1|jsonb||NO||1日目の献立|
|menu2|献立2|jsonb||NO||2日目の献立|
|menu3|献立3|jsonb||NO||3日目の献立|
|menu4|献立4|jsonb||NO||4日目の献立|
|menu5|献立5|jsonb||NO||5日目の献立|
|menu6|献立6|jsonb||NO||6日目の献立|
|menu7|献立7|jsonb||NO||7日目の献立|
|userName|ユーザ名|character varying(20)||NO||献立作成を依頼したユーザ名|
|createAt|作成日時|DateTime||NO|||

テーブル例
|menuId|menu1|menu2|menu3|menu4|menu5|menu6|menu7|userName|createAt|
|:--|:--|:--|:--|:--|:--|:--|:--|:--|:--|
|1|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|{"main": 1000017354,"side": 1020004944, "soup": 1010018234,"staple": 1000000000}|hirohono|2025-09-18 00:00:00|

### recipes

レシピに対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|recipeId|レシピID|integer|〇|NO|||
|data|データ|jsonb||NO|||

テーブル例
|recipeId|data|
|:--|:--|
|1010005904|{ "kind1": "主菜","kind2": "肉料理","kind3": "洋食","recipeTitle": "トースターで♪茄子とキノコのミートソースグラタン"}|

※今後recipeTitleの項目を削除する可能性あり

### recipeItems

レシピに使用される食材に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|recipeId|レシピID|integer|〇|NO|||
|items|食材|jsonb||NO||{"食材名":使用量(g)}の形|

テーブル例
|recipeId|items|
|:--|:--|
|1010005904|{ "なす": 71.25, "ぶなしめじ": 44, "とろけるチーズ": 26.75,"市販ミートソース": 12.5}|

### recipeNutritions

レシピに含まれる栄養素量に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|recipeId|レシピID|integer|〇|NO|||
|nutritions|栄養素|jsonb||NO||{"栄養素名(単位)":含有量,...}の形|

テーブル例
|recipeId|nutritions|
|:--|:--|
|1010005904|{ "鉄(mg)": 0.5105,"脂質(g)": 5.6295,"食塩(g)": 0.1785,"炭水化物(g)": 7.03575,"食物繊維(g)": 2.8875,"ビタミンC(mg)": 2.85,"たんぱく質(g)": 6.92125,"カロリー(kcal)": 97.1275,"ビタミンA(μg)": 80.6375,"ビタミンD(μg)": 0.2735,"カルシウム(mg)": 102.565,"ビタミンB₁(mg)": 0.10455,"ビタミンB₂(mg)": 0.16185}|

### nutritionalTargets

ユーザ情報ごとの目標栄養素量に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|targetId|ターゲットID|integer|〇|NO|主キーがjsonb型だとエラーが出るため追加|
|userInfo|ユーザ情報|jsonb||NO|||
|nutritionals|栄養素|jsonb||NO||{"栄養素名(単位)":"目標値の範囲",...}の形|

テーブル例
|taegetId|userInfo|nutritions|
|:--|:--|:--|
|1||{"年齢": "18~29(歳)","性別": "女性","運動レベル": "ふつう"}|{ "鉄(mg)": "16.8以上","食塩(g)": "18.2未満","食物繊維(g)": "50.4以上", "ビタミンC(mg)": "280以上","カロリー(kcal)": 5460,"ビタミンA(μg)": "1820~7560","ビタミンD(μg)": "25.2~280","カルシウム(mg)": "1820~7000","鉄(mg)・月経時": "28以上","ビタミンB₁(mg)": "2.24以上","ビタミンB₂(mg)": "3.36以上","脂質(%エネルギー)": "20~30","炭水化物(%エネルギー)": "50~65","たんぱく質(%エネルギー)": "13~20"}|

※ソルバーを使用するにあたり目標値の範囲の書き方を変える可能性あり

### itemWeights

特定の食材の重量に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|itemName|食材名|character varying(10)|〇|NO|||
|weights|重量|integer||NO||１個あたりの重量(g)|

テーブル例
|itemName|weights|
|:--|:--|
|しいたけ|13|

### itemEquals

特定の食材同士の紐付に対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|itemName|食材名|character varying(10)|〇|NO|||
|equals|紐付|character varying(10)||NO||食材名と同じ食材としてカウントする食材|

テーブル例
|itemName|equals|
|:--|:--|
|卵|ゆで卵|

### recipeUrl

レシピのURLに対するテーブル

|フィールド名|和名|型|主キー|NULL|その他制約|備考|
|:--|:--|:--|:--|:--|:--|:--|
|recipeId|レシピID|integer|〇|NO|||
|recipeTitle|レシピタイトル|character varying(30)||NO|||
|recipeUrl|レシピURL|character varying||NO||対象レシピの楽天レシピサイトページのURL|
|foodImageUrl|画像URL|character varying||NO||対象レシピの楽天レシピサイトページの画像やいらすとやの画像から入手したURL|

テーブル例
|recipeId|recipeTitle|recipeUrl|foodImageUrl|
|:--|:--|:--|:--|
|1010005904|トースターで♪茄子とキノコのミートソースグラタン|[scrypt:ハッシュ化後の値|{"年齢": "18~29(歳)","性別": "女性","運動レベル": "ふつう"}|https://recipe.rakuten.co.jp/recipe/1010005904/?rafcid=wsc_r_cr_1007871711095680397|https://recipe.r10s.jp/recipe-space/d/strg/ctrl/3/be7afb55b2abc5acda7290e904a044478db143ff.30.2.3.2.jpg?interpolation=lanczos-none&fit=around|716:716&crop=716:716;*,*|














